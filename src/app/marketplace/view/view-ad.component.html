<page-layout [ready]="data$ | async">
  <page-content *ngIf="data" last mode="viewForm" [heading]="title"
    [mobileHeading]="i18n.ad.mobileTitle.details"
    [headingActions]="headingActions$ | async">

    <div *ngIf="ad.image && (layout.ltsm$ | async)"
      class="d-flex justify-content-center mt-2 mb-4">
      <avatar size="160" imageSize="200" useLightbox [image]="ad.image"
        [additionalImages]="ad.additionalImages"></avatar>
    </div>

    <div class="d-flex flex-row-reverse">
      <div *ngIf="layout.gtxs$ | async" class="image ml-4">
        <avatar [size]="ad.image ? 200 : 128" iconSize="128px" useLightbox
          icon="shopping_basket" [image]="ad.image"
          [additionalImages]="ad.additionalImages"></avatar>
      </div>
      <div class="d-flex flex-grow-1 flex-column">
        <label-value [label]="i18n.ad.name" [value]="ad.name"></label-value>
        <label-value [label]="categoryLabel">
          <ng-container *ngFor="let category of (ad.categories || [])">
            <div>
              <ng-container
                *ngFor="let curr of categoryLevels(category); let first = first;">
                <ng-container *ngIf="!first">
                  &gt;
                </ng-container>
                {{ curr.name }}
              </ng-container>
            </div>
          </ng-container>
        </label-value>
        <label-value [label]="i18n.ad.owner">
          <user-link [user]="ad.owner"></user-link>
        </label-value>
        <label-value *ngIf="status" [label]="i18n.general.status">
          {{ status }}
        </label-value>
        <label-value *ngIf="ad.price" [label]="i18n.ad.price">
          <ng-container *ngIf="ad.promotionalPrice">
            <span class="promo-price">
              {{ ad.price | currency:ad.currency }}
            </span>
            {{ ad.promotionalPrice | currency:ad.currency }}
          </ng-container>
          <ng-container *ngIf="ad.promotionalPrice == null">
            {{ ad.price | currency:ad.currency }}
          </ng-container>
        </label-value>
        <ng-container *ngIf="data.canEdit">
          <label-value [label]="i18n.ad.beginDate">
            {{ data.publicationPeriod.begin | date }}
          </label-value>
          <label-value [label]="i18n.ad.endDate">
            {{ data.publicationPeriod.end | date }}
          </label-value>
        </ng-container>
        <custom-field-value *ngFor="let value of ad.customValues"
          [fieldValue]="value"></custom-field-value>
        <ng-container *ngIf="webshop">
          <label-value *ngIf="!data.unlimitedStock"
            [label]="i18n.ad.stockQuantity">
            {{ stock }}
          </label-value>
          <label-value *ngIf="data.minAllowedInCart"
            [label]="i18n.ad.minAllowedInCart">
            {{ formatStock(data.minAllowedInCart) }}
          </label-value>
          <label-value *ngIf="data.maxAllowedInCart"
            [label]="i18n.ad.maxAllowedInCart">
            {{ formatStock(data.maxAllowedInCart) }}
          </label-value>
          <label-value [label]="i18n.ad.productNumber">
            {{ data.productNumber }}
          </label-value>
        </ng-container>
      </div>
    </div>

    <ng-container *ngIf="data.lastAuthorizationComments">
      <h2 class="d-none d-sm-block my-3 pt-3">{{ i18n.ad.authorizationNotes }}
      </h2>
      <hr class="d-block d-sm-none">
      {{ ad.lastAuthorizationComments }}
    </ng-container>
    <h2 class="d-none d-sm-block my-3 pt-3">{{ i18n.general.description }}
    </h2>
    <hr class="d-block d-sm-none">
    <rich-text-container autoHeight [value]="ad.description">
    </rich-text-container>
    <div *ngIf="data.deliveryMethods">
      <h2 class="mt-3"> {{ i18n.ad.deliveryMethods }} </h2>
      <ng-container *ngFor="let dm of data.deliveryMethods">
        <h3> {{ dm.name }} </h3>
        <label-value [label]="i18n.ad.deliveryTime">
          {{ formatTimeInterval(dm.deliveryTime) }}
        </label-value>
        <label-value *ngIf="hasFixedPrice(dm)" [label]="i18n.ad.price">
          {{ dm.chargeAmount | currency:ad.currency }}
        </label-value>
        <label-value *ngIf="dm.description"
          [label]="i18n.general.description">
          {{ dm.description }}
        </label-value>
      </ng-container>
    </div>
    <div *ngIf="addresses?.length > 0" class="d-flex flex-grow-1 flex-column">
      <ng-container>
        <h2 class="mt-3">
          <ng-container *ngIf="addresses?.length > 1">
            <!-- Reuse the same key as the user's -->
            {{ i18n.user.title.addresses }}
          </ng-container>
          <ng-container *ngIf="addresses?.length == 1">
            <!-- Reuse the same key as the user's -->
            {{ i18n.address.address }}
          </ng-container>
        </h2>
        <ng-container
          *ngFor="let address of addresses; let first = first; let last = last">
          <div class="row no-gutters" [ngClass]="{'mt-3': !first}">
            <div class="col-12 col-md-6">
              <h3 *ngIf="addresses.length > 1" class="mt-0">
                {{ address.name }}
              </h3>
              <address-details [address]="address"></address-details>
            </div>
            <div *ngIf="maps.enabled && address.location"
              class="col-12 col-md-6"
              [ngClass]="{'pt-2': layout.ltsm$ | async, 'mb-2': !last}">
              <static-map [address]="address"></static-map>
            </div>
          </div>
        </ng-container>
      </ng-container>
    </div>
  </page-content>
